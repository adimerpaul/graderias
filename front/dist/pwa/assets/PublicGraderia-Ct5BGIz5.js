import{Q as v}from"./QSpace-BST11wqG.js";import{_ as B,c as R,o as g,w as a,a as o,Q as E,e as h,b as e,t as i,f as Q,H as y,G as f,I as m,F as O,J as w,K as D}from"./index-OwtYWoAQ.js";import{Q as b}from"./QBanner-BWDlJ7n7.js";import{Q as _}from"./QChip-DossVyCq.js";import{Q as L}from"./QBadge-CZFbtcNj.js";import{Q as S}from"./QPage-ckpw9esh.js";const q={name:"PublicGraderia",data(){return{loading:!1,graderia:null,asientos:[],seatMap:{},statusMeta:{NO_GENERADO:{label:"No generado",color:"grey-7",bg:"#e6e6e6"},LIBRE:{label:"Libre",color:"positive",bg:"#82f38b"},RESERVADO:{label:"Reservado",color:"warning",bg:"#f3d77d"},PAGADO:{label:"Pagado",color:"primary",bg:"#79bcee"},BLOQUEADO:{label:"Bloqueado",color:"negative",bg:"#ec7385"}}}},computed:{code(){return this.$route.params.code},stats(){const t={total:Number(this.graderia?.filas||0)*Number(this.graderia?.columnas||0),libre:0,reservado:0,pagado:0,bloqueado:0,ocupado:0};for(const c of this.asientos){const l=this.normalizeEstado(c.estado)||"LIBRE";l==="LIBRE"&&t.libre++,l==="RESERVADO"&&t.reservado++,l==="PAGADO"&&t.pagado++,l==="BLOQUEADO"&&t.bloqueado++}return t.ocupado=t.reservado+t.pagado+t.bloqueado,t},gridSeats(){if(!this.graderia)return[];const s=Number(this.graderia.filas||0),t=Number(this.graderia.columnas||0);if(s<=0||t<=0)return[];const c=this.graderia.start_top?this.range(1,s):this.range(1,s).reverse(),l=this.graderia.start_left?this.range(1,t):this.range(1,t).reverse(),d=[];for(const r of c){const u=[];for(const p of l){const n=this.makeCode(r,p),x=this.seatMap[n]||null,A=x?this.normalizeEstado(x.estado)||"LIBRE":"NO_GENERADO";u.push({codigo:n,status:A})}d.push(u)}return d}},mounted(){this.load()},methods:{load(){this.code&&(this.loading=!0,this.$axios.get(`public/graderias/${this.code}`).then(s=>{const t=s.data;this.graderia=t.graderia,this.asientos=t.asientos||[];const c={};for(const l of this.asientos)c[l.codigo]=l;this.seatMap=c}).catch(()=>{this.$alert?.error?.("No se pudo cargar la graderÃ­a")}).finally(()=>{this.loading=!1}))},normalizeEstado(s){if(!s)return"";const t=String(s).toUpperCase();return["LIBRE","RESERVADO","PAGADO","BLOQUEADO"].includes(t)?t:""},range(s,t){const c=[];for(let l=s;l<=t;l++)c.push(l);return c},numToLetters(s){let t="";for(s=Number(s);s>0;)s--,t=String.fromCharCode(65+s%26)+t,s=Math.floor(s/26);return t},makeCode(s,t){return String(this.graderia.etiqueta_modo)==="fila"?`${this.numToLetters(s)}${t}`:`${this.numToLetters(t)}${s}`},seatBg(s){return this.statusMeta[s.status]?.bg||"#ffffff"},cellStyle(){return{textAlign:"center",opacity:1}}}},N={class:"text-subtitle1 text-weight-bold"},M={class:"text-caption text-grey-7"},k={class:"row q-col-gutter-xs"},G={class:"col-6 col-md-3"},C={class:"text-subtitle1 text-weight-bold"},P={class:"col-6 col-md-3"},I={class:"text-subtitle1 text-weight-bold"},V={class:"col-6 col-md-3"},T={class:"text-subtitle1 text-weight-bold"},U={class:"col-6 col-md-3"},z={class:"text-subtitle1 text-weight-bold"},F={class:"row q-col-gutter-xs q-mt-xs"},H={class:"col-12 col-md-3"},J={class:"col-12 col-md-3"},K={class:"col-12 col-md-3"},j={class:"col-12 col-md-3"},W={style:{width:"100%",overflow:"auto"}},X={border:"1",cellpadding:"6",cellspacing:"0",width:"100%"},Y=["bgcolor"],Z={class:"text-weight-bold"},$={style:{"font-size":"11px"}};function tt(s,t,c,l,d,r){return g(),R(S,{class:"q-pa-sm"},{default:a(()=>[o(E,{flat:"",bordered:""},{default:a(()=>[o(h,{class:"row items-center q-py-sm"},{default:a(()=>[e("div",null,[e("div",N,i(d.graderia?.nombre||"GraderÃ­a"),1),e("div",M,i(d.graderia?.direccion||""),1)]),o(v),o(Q,{dense:"","no-caps":"",color:"primary",icon:"refresh",label:"Recargar",loading:d.loading,onClick:t[0]||(t[0]=u=>r.load())},null,8,["loading"])]),_:1}),o(y),o(h,{class:"q-pa-sm"},{default:a(()=>[e("div",k,[e("div",G,[o(b,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[1]||(t[1]=e("div",{class:"text-caption text-grey-7"},"Total asientos",-1)),e("div",C,i(r.stats.total),1)]),_:1})]),e("div",P,[o(b,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[2]||(t[2]=e("div",{class:"text-caption text-grey-7"},"Disponibles",-1)),e("div",I,i(r.stats.libre),1)]),_:1})]),e("div",V,[o(b,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[3]||(t[3]=e("div",{class:"text-caption text-grey-7"},"Reservados",-1)),e("div",T,i(r.stats.reservado),1)]),_:1})]),e("div",U,[o(b,{dense:"",class:"bg-grey-1"},{default:a(()=>[t[4]||(t[4]=e("div",{class:"text-caption text-grey-7"},"Pagados/Bloqueados",-1)),e("div",z,i(r.stats.ocupado),1)]),_:1})])]),e("div",F,[e("div",H,[o(_,{dense:"",color:d.statusMeta.LIBRE.color,"text-color":"white",icon:"event_seat"},{default:a(()=>[f(" LIBRE: "+i(r.stats.libre),1)]),_:1},8,["color"])]),e("div",J,[o(_,{dense:"",color:d.statusMeta.RESERVADO.color,"text-color":"white",icon:"bookmark"},{default:a(()=>[f(" RESERVADO: "+i(r.stats.reservado),1)]),_:1},8,["color"])]),e("div",K,[o(_,{dense:"",color:d.statusMeta.PAGADO.color,"text-color":"white",icon:"paid"},{default:a(()=>[f(" PAGADO: "+i(r.stats.pagado),1)]),_:1},8,["color"])]),e("div",j,[o(_,{dense:"",color:d.statusMeta.BLOQUEADO.color,"text-color":"white",icon:"block"},{default:a(()=>[f(" BLOQUEADO: "+i(r.stats.bloqueado),1)]),_:1},8,["color"])])])]),_:1})]),_:1}),o(E,{flat:"",bordered:"",class:"q-mt-sm"},{default:a(()=>[o(h,{class:"row items-center q-py-sm"},{default:a(()=>[t[5]||(t[5]=e("div",{class:"text-subtitle2 text-weight-bold"},"Mapa de asientos",-1)),o(v),o(L,{outline:"",color:"primary"},{default:a(()=>[f(" Total "+i(r.stats.total)+" asientos ",1)]),_:1})]),_:1}),o(y),o(h,{class:"q-pa-sm"},{default:a(()=>[e("div",W,[e("table",X,[e("tbody",null,[(g(!0),m(O,null,w(r.gridSeats,(u,p)=>(g(),m("tr",{key:p},[(g(!0),m(O,null,w(u,n=>(g(),m("td",{key:n.codigo,bgcolor:r.seatBg(n),style:D(r.cellStyle(n))},[e("div",Z,i(n.codigo),1),e("div",$,i(d.statusMeta[n.status].label),1)],12,Y))),128))]))),128))])])])]),_:1})]),_:1})]),_:1})}const it=B(q,[["render",tt]]);export{it as default};
